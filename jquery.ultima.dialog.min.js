// MIT, Copyright (c) 2014-2018 Alexander Kwaschny, kwaschny.net
(function(){"use strict";if(!window.UltimaDialog){if(jQuery===undefined){throw new Error("jQuery missing for UltimaDialog")}if(!jQuery.isPlainObject){throw new Error("jQuery 1.4+ required for UltimaDialog")}window.UltimaDialog=function(options){if(!(this instanceof UltimaDialog)){return new UltimaDialog(options)}this._={};var self=this;var jqWindow=jQuery(window);var jqBody=jQuery("body");if(jqWindow.length===0||jqBody.length===0){throw new Error("HTML document malformed")}this.curtain=null;this.window=null;this.options={};this.options.current={};this.options["default"]={animations:{curtain:{show:{effect:"fadeIn",duration:400},hide:{effect:undefined,duration:undefined},deferProgression:false},window:{show:{effect:"fadeIn",duration:400},hide:{effect:undefined,duration:undefined},deferProgression:false,reposition:{duration:100},resize:{duration:200,rate:200}}},behavior:{ajax:{cache:false},closeOnCurtain:true,closeOnEscape:true,closeOnWindow:true,disableScrolling:"auto",preventOverflow:true,trackSubmit:true,translateMedia:true,zIndexInc:true},css:{loading:{className:"",content:undefined,x:"50%",y:"50%"},curtain:{applyFilter:undefined,className:"",isVisible:true,zIndex:9003},window:{className:"",close:{className:""},hardMarginX:0,hardMarginY:0,x:"50%",y:"50%",zIndex:9004}},callbacks:{onOpening:undefined,onCurtainOpened:undefined,onWindowOpened:undefined,onContentReady:undefined,onContentVisible:undefined,onAsyncSuccess:undefined,onAsyncError:undefined,onSubmit:undefined,onClosing:undefined,onCurtainClosed:undefined,onWindowClosed:undefined}};this._.properties={classNames:{curtain:"UltimaDialog-curtain",window:{frame:"UltimaDialog-window",content:"UltimaDialog-window-content",close:"UltimaDialog-window-close"}},simulateBorderBox:window.atob===undefined,simulateTransparentBackground:window.atob===undefined,supportsFilter:window.atob!==undefined,supportsMedia:window.atob!==undefined};this.show=function(content){if(jQuery.isFunction(this.options.current.callbacks.onOpening)){if(this.options.current.callbacks.onOpening(self)===false){return false}}this.curtain=self._.methods.createCurtain();this.window=self._.methods.createWindow(content);this.curtain._.properties.window=this.window;this.window._.properties.curtain=this.curtain;if(this.options.current.behavior.disableScrolling===true){UltimaDialog._.methods.disableScrolling(jqBody)}jqBody.append(this.curtain.dom.element).append(this.window.dom.element);this.window.relocate();if(this.options.current.animations.curtain.deferProgression===true){this.curtain.show(function(){if(jQuery.isFunction(self.options.current.callbacks.onCurtainOpened)){self.options.current.callbacks.onCurtainOpened(self)}self.window.show(self.window._.properties.isAjax);if(self.window.dom.loading){self.window.dom.loading.css(self.window._.methods.calcInnerPosition(self.window.dom.loading))}})}else{this.curtain.show(function(){if(jQuery.isFunction(self.options.current.callbacks.onCurtainOpened)){self.options.current.callbacks.onCurtainOpened(self)}});this.window.show(self.window._.properties.isAjax);if(this.window.dom.loading){this.window.dom.loading.css(this.window._.methods.calcInnerPosition(this.window.dom.loading))}}return true};this.image=function(image,attr){this.show({media:"image",resource:image,attributes:attr});return true};this.video=function(url,attr){this.show({media:"video",resource:url,attributes:attr});return true};this.audio=function(url,attr){this.show({media:"audio",resource:url,attributes:attr});return true};jQuery.each(["get","post","put","delete"],function(i,type){self[type]=function(url,data,ajaxSettings){this.show({method:type.toUpperCase(),url:url,data:data,settings:ajaxSettings});return true}});this.iframe=function(url,attr){this.show({media:"iframe",resource:url,attributes:attr});return true};this.close=function(callback,duration){if(!jQuery.isFunction(callback)){duration=callback;callback=undefined}UltimaDialog._.methods.enableScrolling(jqBody);if(this.window!==null){this.window.close(callback,duration);return true}return false};this._.methods={createCurtain:function(){var curtain={dom:{element:jQuery("<div></div>").hide()},close:function(callback,duration){var that=this;if(typeof callback==="number"){duration=callback;callback=undefined}this._.methods.filterOff();switch(self.options.current.animations.curtain.hide.effect){default:this.dom.element.stop(true,true).fadeOut(duration===undefined?self.options.current.animations.curtain.hide.duration:duration,function(){that.dom.element.remove();if(jQuery.isFunction(callback)){callback(self)}if(jQuery.isFunction(self.options.current.callbacks.onCurtainClosed)){self.options.current.callbacks.onCurtainClosed(self)}});break}return true},show:function(callback){var that=this;switch(self.options.current.animations.curtain.show.effect){default:this.dom.element.fadeIn(self.options.current.animations.curtain.show.duration,function(){that.isOpened=true;if(jQuery.isFunction(callback)){callback(self)}});break}return true},_:{properties:{isOpened:false,window:undefined},methods:{filterOn:function(){if(self._.properties.supportsFilter===false){return false}var filter=self.options.current.css.curtain.applyFilter;if(typeof filter!=="string"){return false}var buffer=jqBody.children(":not(script, style)");jQuery.each(buffer,function(i,element){var e=jQuery(element);if(!e.hasClass(self._.properties.classNames.curtain)&&!e.hasClass(self._.properties.classNames.window)){e.css({"-webkit-filter":filter,filter:filter})}});return true},filterOff:function(){if(self._.properties.supportsFilter===false){return false}var filter=self.options.current.css.curtain.applyFilter;if(typeof filter!=="string"){return false}var buffer=jqBody.children(":not(script, style)");jQuery.each(buffer,function(i,element){var e=jQuery(element);if(!e.hasClass(self._.properties.classNames.curtain)&&!e.hasClass(self._.properties.classNames.window)){e.css({"-webkit-filter":"",filter:""})}});return true}}}};curtain.dom.element.addClass(self._.properties.classNames.curtain);curtain.dom.element.addClass(self.options.current.css.curtain.className);var cssAttr={};if(!self.options.current.css.curtain.className){cssAttr.backgroundColor="#000000";cssAttr.opacity=.67}jQuery.extend(true,cssAttr,self.options.current.css.curtain);jQuery.extend(true,cssAttr,{bottom:0,height:"100%",left:0,position:"fixed",right:0,top:0,width:"100%",zIndex:self.options.current.css.curtain.zIndex+(self.options.current.behavior.zIndexInc?UltimaDialog.collection.length:0)});if(self.options.current.css.curtain.isVisible===false){cssAttr.background=self._.properties.simulateTransparentBackground?"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)":"transparent"}curtain.dom.element.css(cssAttr);curtain._.methods.filterOn();curtain.dom.element.click(function(){if(self.options.current.behavior.closeOnCurtain!==true){return}if(!curtain.isOpened){return}if(self.options.current.behavior.disableScrolling!==false){UltimaDialog._.methods.enableScrolling(jqBody)}curtain._.properties.window.close()});return curtain},createWindow:function(content,shadow){var window={dom:{element:jQuery("<div></div>").hide(),content:jQuery("<div></div>").css("opacity",0),loading:undefined,closeButton:undefined},_:{properties:{curtain:undefined,isAjax:false,url:undefined},methods:{attachSubmitTracking:function(){if(shadow){return false}var forms=window.dom.content.find("form");forms.submit(function(event){event.preventDefault();return UltimaDialog._.methods.submit(this)});return true},calcPosition:function(width,height){var result={};if(width===undefined){width=window.dom.element.outerWidth()}if(height===undefined){height=window.dom.element.outerHeight()}if(/^[0-9]{1,3}%$/.test(self.options.current.css.window.x)){result.left=self.options.current.css.window.x.replace("%","")*jqWindow.width()/100-width/2}else{result.left=self.options.current.css.window.x}if(result.left<0){result.left=0}if(/^[0-9]{1,3}%$/.test(self.options.current.css.window.y)){result.top=self.options.current.css.window.y.replace("%","")*jqWindow.height()/100-height/2}else{result.top=self.options.current.css.window.y}if(result.top<0){result.top=0}return result},calcInnerPosition:function(element){var result={};if(/^[0-9]{1,3}%$/.test(self.options.current.css.loading.x)){result.marginLeft=self.options.current.css.loading.x.replace("%","")*window.dom.content.width()/100-element.width()/2}else{result.marginLeft=self.options.current.css.loading.x}if(result.marginLeft<0){result.marginLeft=0}if(/^[0-9]{1,3}%$/.test(self.options.current.css.loading.y)){var vPadding=0;var outerPadding=window._.methods.getPadding(window.dom.element);vPadding+=outerPadding.bottom+outerPadding.top;var innerPadding=window._.methods.getPadding(window.dom.content);vPadding+=innerPadding.bottom+innerPadding.top;result.marginTop=self.options.current.css.loading.y.replace("%","")*(window.dom.element.innerHeight()-vPadding)/100-element.height()/2}else{result.marginTop=self.options.current.css.loading.y}if(result.marginTop<0){result.marginTop=0}return result},calcSize:function(content){var element=self._.methods.createWindow(content,true).dom.element;element.css({display:"none",left:0,top:0});jqBody.append(element);var result={width:element.outerWidth(),height:element.outerHeight()};if(self._.properties.simulateBorderBox){var padding=window._.methods.getPadding(element);result.width-=padding.left+padding.right;result.height-=padding.bottom+padding.top}element.remove();var widthCap=jqWindow.width();widthCap-=self.options.current.css.window.hardMarginX;var heightCap=jqWindow.height();heightCap-=self.options.current.css.window.hardMarginY;if(result.width>widthCap){result.width=widthCap}if(result.height>heightCap){result.height=heightCap}return result},getPadding:function(element){var result={bottom:parseInt(element.css("padding-bottom"),10),left:parseInt(element.css("padding-left"),10),right:parseInt(element.css("padding-right"),10),top:parseInt(element.css("padding-top"),10)};result={bottom:isNaN(result.bottom)?0:result.bottom,left:isNaN(result.left)?0:result.left,right:isNaN(result.right)?0:result.right,top:isNaN(result.top)?0:result.top};return result},rememberSize:function(element){var size={width:element.outerWidth(),height:element.outerHeight()};if(self._.properties.simulateBorderBox){var padding=window._.methods.getPadding(element);size.width-=padding.left+padding.right;size.height-=padding.bottom+padding.top}element.css({"min-height":size.height,"min-width":size.width});return true},setLoading:function(){if(self.options.current.css.loading.content||self.options.current.css.loading.className){var loading=jQuery("<div></div>");loading.addClass(self.options.current.css.loading.className);var cssAttr={};jQuery.extend(cssAttr,self.options.current.css.loading);delete cssAttr.content;loading.css(cssAttr);if(typeof self.options.current.css.loading.content==="string"){loading.html(self.options.current.css.loading.content)}else if(self.options.current.css.loading.content instanceof jQuery){loading.append(jQuery(self.options.current.css.loading.content).clone(true).show())}window.dom.loading=loading;window.dom.content.append(loading);window.dom.content.fadeTo(self.options.current.animations.window.resize.duration,1)}}}},close:function(callback,duration){var that=this;if(jQuery.isFunction(self.options.current.callbacks.onClosing)){if(self.options.current.callbacks.onClosing(self)===false){return false}}for(var i=0;i<UltimaDialog.collection.length;i++){if(this===UltimaDialog.collection[i].window){UltimaDialog.collection.splice(i,1)}}switch(self.options.current.animations.window.hide.effect){default:if(self.options.current.animations.window.deferProgression!==true){this._.properties.curtain.close(duration===undefined?undefined:0)}this.dom.element.stop(true,true).fadeOut(duration===undefined?self.options.current.animations.window.hide.duration:0,function(){that.dom.element.remove();if(jQuery.isFunction(callback)){callback(self)}if(jQuery.isFunction(self.options.current.callbacks.onWindowClosed)){self.options.current.callbacks.onWindowClosed(self)}if(self.options.current.animations.window.deferProgression===true){that._.properties.curtain.close(duration===undefined?undefined:0)}});break}return true},reposition:function(duration,callbackBefore,callbackAfter){if(duration===undefined){duration=0}else{if(jQuery.isFunction(duration)){if(jQuery.isFunction(callbackBefore)){callbackAfter=callbackBefore;callbackBefore=duration;duration=0}else{callbackAfter=duration;duration=0}}else{if(!jQuery.isFunction(callbackAfter)){callbackAfter=callbackBefore;callbackBefore=undefined}}}var pos=this._.methods.calcPosition();if(duration>0){if(jQuery.isFunction(callbackBefore)){if(callbackBefore(this)===false){return false}}this.dom.element.animate(pos,duration,callbackAfter)}else{if(jQuery.isFunction(callbackBefore)){if(callbackBefore(this)===false){return false}}this.dom.element.css(pos);if(jQuery.isFunction(callbackAfter)){callbackAfter(this)}}return true},resetContent:function(callback,removeSelector){window.dom.content.fadeTo(self.options.current.animations.window.resize.duration,0,function(){if(removeSelector!==undefined){window.dom.content.children(removeSelector).remove()}else{window.dom.content.html("")}if(jQuery.isFunction(callback)){callback(self)}});return true},resize:function(disableScrolling){if(self.options.current.behavior.preventOverflow!==true){return false}var isFixed=self.options.current.css.window.width!==undefined||self.options.current.css.window.height!==undefined;var actualWidth=self.options.current.css.window.width;if(/^[0-9]{1,3}%$/.test(actualWidth)){actualWidth=actualWidth.replace("%","")*jqWindow.width()/100}if(isNaN(parseFloat(actualWidth))){actualWidth=this.dom.element.outerWidth()}var actualHeight=self.options.current.css.window.height;if(/^[0-9]{1,3}%$/.test(actualHeight)){actualHeight=actualHeight.replace("%","")*jqWindow.height()/100}if(isNaN(parseFloat(actualHeight))){actualHeight=this.dom.element.outerHeight()}var padding=this._.methods.getPadding(this.dom.element);var paddingH=padding.left+padding.right;var paddingV=padding.bottom+padding.top;var marginH=self.options.current.css.window.hardMarginX;var marginV=self.options.current.css.window.hardMarginY;var actualOverflow=false;var maxViewportWidth=jqWindow.width()-paddingH-marginH;if(actualWidth>=maxViewportWidth){actualOverflow=true;actualWidth=maxViewportWidth;this.dom.element.css({minWidth:""});this.dom.content.css({overflow:"auto",maxWidth:actualWidth})}else{this.dom.content.css("max-width","");if(isFixed){this.dom.content.css("width",actualWidth-paddingH-marginH)}else{this.dom.content.css("width","")}}var maxViewportHeight=jqWindow.height()-paddingV-marginV;if(actualHeight>=maxViewportHeight){actualOverflow=true;actualHeight=maxViewportHeight;this.dom.element.css({minHeight:""});this.dom.content.css({overflow:"auto",maxHeight:actualHeight})}else{this.dom.content.css("max-height","");if(isFixed){this.dom.content.css("height",actualHeight-paddingV-marginV)}else{this.dom.content.css("height","")}}this.dom.content.css("overflow",isFixed||actualOverflow?"auto":"");if(self.options.current.behavior.disableScrolling==="auto"){if(disableScrolling||isFixed||actualOverflow){UltimaDialog._.methods.disableScrolling(jqBody);this.dom.content.css({maxWidth:jqWindow.width()-paddingH-marginH,maxHeight:jqWindow.height()-paddingV-marginV})}else{UltimaDialog._.methods.enableScrolling(jqBody)}}return true},relocate:function(animate){var duration=0;if(animate===true){duration=self.options.current.animations.window.reposition.duration}this.resize();this.reposition(duration);return true},setContent:function(content,invokeCallback){if(!content){window.resetContent();return false}window._.properties.isAjax=false;window._.properties.url=location.href;if(/^(GET|POST|PUT|DELETE)$/i.test(content.method)){window._.properties.isAjax=true;window._.methods.setLoading();var ajaxSettings=jQuery.extend(true,content.settings,{type:content.method,url:content.url,data:content.data,cache:self.options.current.behavior.ajax.cache,success:function(response){if(jQuery.isFunction(self.options.current.callbacks.onAsyncSuccess)){if(self.options.current.callbacks.onAsyncSuccess(self,response)===false){return false}}window._.methods.rememberSize(window.dom.element);var size=window._.methods.calcSize(response);var pos=window._.methods.calcPosition(size.width,size.height);window.resetContent(function(){window.dom.loading=undefined;window.dom.element.animate({"min-height":size.height,left:pos.left,top:pos.top,"min-width":size.width},self.options.current.animations.window.resize.duration,function(){if(jQuery.isFunction(self.options.current.callbacks.onContentReady)){if(self.options.current.callbacks.onContentReady(self,response)===false){return}}window.dom.content.html(response);if(self.options.current.behavior.trackSubmit===true){window._.methods.attachSubmitTracking()}window.resize();window.dom.content.fadeTo(self.options.current.animations.window.show.duration,1,function(){if(jQuery.isFunction(self.options.current.callbacks.onContentVisible)){self.options.current.callbacks.onContentVisible(self)}})})})},error:function(qXHR){var response=qXHR.status+": "+qXHR.statusText;if(jQuery.isFunction(self.options.current.callbacks.onAsyncError)){self.options.current.callbacks.onAsyncError(self,qXHR)}window._.methods.rememberSize(window.dom.element);var size=window._.methods.calcSize(response);var pos=window._.methods.calcPosition(size.width,size.height);window.resetContent(function(){window.dom.loading=undefined;window.dom.element.animate({"min-height":size.height,left:pos.left,top:pos.top,"min-width":size.width},self.options.current.animations.window.resize.duration,function(){if(jQuery.isFunction(self.options.current.callbacks.onContentReady)){if(self.options.current.callbacks.onContentReady(self,response)===false){return}}window.dom.content.html(response);window.resize();window.dom.content.fadeTo(self.options.current.animations.window.show.duration,1,function(){if(jQuery.isFunction(self.options.current.callbacks.onContentVisible)){self.options.current.callbacks.onContentVisible(self)}})})})}});window._.properties.url=ajaxSettings.url;if(content.method==="GET"){window.query=ajaxSettings.data}else{window.query=""}jQuery.ajax(ajaxSettings)}else if(content.media==="iframe"){var iframe=jQuery("<iframe>").css({height:0,opacity:0,width:0});if(!content.attributes){content.attributes={}}if(typeof content.attributes.width!=="number"){content.attributes.width=640}if(typeof content.attributes.height!=="number"){content.attributes.height=360}iframe.attr(content.attributes);iframe.attr("src",content.resource);window.dom.content.html(iframe);iframe.on("load",function(){iframe.unbind("load");if(jQuery.isFunction(self.options.current.callbacks.onAsyncSuccess)){if(self.options.current.callbacks.onAsyncSuccess(self,content.resource)===false){return false}}window._.methods.rememberSize(window.dom.element);var padding=window._.methods.getPadding(window.dom.element);var size={width:(isNaN(parseInt(iframe.attr("width"),10))?0:parseInt(iframe.attr("width"),10))+(self._.properties.simulateBorderBox?0:padding.left+padding.right),height:(isNaN(parseInt(iframe.attr("height"),10))?0:parseInt(iframe.attr("height"),10))+(self._.properties.simulateBorderBox?0:padding.bottom+padding.top)};var pos=window._.methods.calcPosition(size.width,size.height);window.resetContent(function(){window.dom.loading=undefined;window.dom.element.animate({"min-height":size.height,left:pos.left,top:pos.top,"min-width":size.width},self.options.current.animations.window.resize.duration,function(){iframe.css({height:"",opacity:1,width:""});if(jQuery.isFunction(self.options.current.callbacks.onContentReady)){if(self.options.current.callbacks.onContentReady(self,iframe)===false){return}}window.resize();window.dom.content.fadeTo(self.options.current.animations.window.show.duration,1,function(){if(jQuery.isFunction(self.options.current.callbacks.onContentVisible)){self.options.current.callbacks.onContentVisible(self)}})})},":not(iframe)")});window._.methods.setLoading()}else if(content.media==="image"){var preload=jQuery("<img>");preload.on("load",function(){if(jQuery.isFunction(self.options.current.callbacks.onAsyncSuccess)){if(self.options.current.callbacks.onAsyncSuccess(self,content.resource)===false){return false}}window._.methods.rememberSize(window.dom.element);var size=window._.methods.calcSize(preload);var pos=window._.methods.calcPosition(size.width,size.height);window.resetContent(function(){window.dom.loading=undefined;window.dom.element.animate({"min-height":size.height,left:pos.left,top:pos.top,"min-width":size.width},self.options.current.animations.window.resize.duration,function(){if(jQuery.isFunction(self.options.current.callbacks.onContentReady)){if(self.options.current.callbacks.onContentReady(self,preload)===false){return}}window.dom.content.html(preload);window.resize();window.dom.content.fadeTo(self.options.current.animations.window.show.duration,1,function(){if(jQuery.isFunction(self.options.current.callbacks.onContentVisible)){self.options.current.callbacks.onContentVisible(self)}})})})});if(!content.attributes){content.attributes={}}if(content.attributes.width){preload.css("width",content.attributes.width);delete content.attributes.width}else{preload.css("width","auto")}if(content.attributes.height){preload.css("height",content.attributes.height);delete content.attributes.height}else{preload.css("height","auto")}preload.attr(content.attributes);preload.attr("src",content.resource);window._.methods.setLoading()}else if(content.media==="video"||content.media==="audio"){var media=jQuery("<"+content.media+">").attr("controls","controls").css({height:0,opacity:0,width:0});if(!jQuery.isArray(content.resource)){content.resource=[content.resource]}jQuery.each(content.resource,function(i,url){var src=jQuery("<source>").attr("src",url);media.append(src)});media.append(jQuery("<a>").attr("href",content.resource[0]).text(content.resource[0]));var minSize={video:{width:640,height:360},audio:{width:320,height:30}};if(jqWindow[0].ActiveXObject||"ActiveXObject"in jqWindow[0]){minSize.audio.width=580;minSize.audio.height=80}if(!content.attributes){content.attributes={}}if(typeof content.attributes.width!=="number"){content.attributes.width=minSize[content.media].width}if(typeof content.attributes.height!=="number"){content.attributes.height=minSize[content.media].height}media.attr(content.attributes);media.attr("src",content.resource);window.dom.content.html(media);var mediaLoad=function(){if(jQuery.isFunction(self.options.current.callbacks.onAsyncSuccess)){if(self.options.current.callbacks.onAsyncSuccess(self,content.resource)===false){return false}}window._.methods.rememberSize(window.dom.element);var padding=window._.methods.getPadding(window.dom.element);var size={width:(isNaN(parseInt(media.attr("width"),10))?0:parseInt(media.attr("width"),10))+(padding.left+padding.right),height:(isNaN(parseInt(media.attr("height"),10))?0:parseInt(media.attr("height"),10))+(padding.bottom+padding.top)};var pos=window._.methods.calcPosition(size.width,size.height);window.resetContent(function(){window.dom.loading=undefined;window.dom.element.animate({"min-height":size.height,left:pos.left,top:pos.top,"min-width":size.width},self.options.current.animations.window.resize.duration,function(){media.css({height:"",opacity:1,width:content.attributes.width});if(jQuery.isFunction(self.options.current.callbacks.onContentReady)){if(self.options.current.callbacks.onContentReady(self,media)===false){return}}window.resize();window.dom.content.fadeTo(self.options.current.animations.window.show.duration,1,function(){if(jQuery.isFunction(self.options.current.callbacks.onContentVisible)){self.options.current.callbacks.onContentVisible(self)}})})},":not("+content.media+")")};if(self._.properties.supportsMedia){media[0].onloadstart=mediaLoad}else{if(jQuery.isFunction(self.options.current.callbacks.onAsyncError)){self.options.current.callbacks.onAsyncError(self,"Browser does not support the required media tag: "+content.media)}setTimeout(mediaLoad,200)}window._.methods.setLoading()}else if(typeof content==="string"){if(self.options.current.behavior.translateMedia===true){if(/\.(gif|jpe?g|png)(\?|$)/i.test(content)){return window.setContent({media:"image",resource:content})}if(/\.(mp3)(\?|$)/i.test(content)){return window.setContent({media:"audio",resource:content})}}if(invokeCallback!==false&&jQuery.isFunction(self.options.current.callbacks.onContentReady)){if(self.options.current.callbacks.onContentReady(self,content)===false){return false}}window.dom.content.html(content);if(self.options.current.behavior.trackSubmit===true){window._.methods.attachSubmitTracking()}}else{content=jQuery(content).clone(true);content.removeAttr("id").find("[id]").removeAttr("id");content.find("[data-ultimadialog-id]").each(function(){var e=jQuery(this);var refID=e.attr("data-ultimadialog-id");var randID=refID+Math.floor(Math.random()*1e4);e.attr("id",randID);content.find('[data-ultimadialog-for="'+refID+'"]').attr("for",randID)});if(invokeCallback!==false&&jQuery.isFunction(self.options.current.callbacks.onContentReady)){if(self.options.current.callbacks.onContentReady(self,content)===false){return false}}window.dom.content.html(content.show());if(self.options.current.behavior.trackSubmit===true){window._.methods.attachSubmitTracking()}}return true},show:function(isAsync){var that=this;switch(self.options.current.animations.window.show.effect){default:if(self.options.current.animations.curtain.deferProgression!==true){this.dom.content.css("opacity",1)}this.dom.element.fadeIn(self.options.current.animations.window.show.duration,function(){if(jQuery.isFunction(self.options.current.callbacks.onWindowOpened)){self.options.current.callbacks.onWindowOpened(self)}if(self.options.current.animations.curtain.deferProgression===true){that.dom.content.fadeTo(self.options.current.animations.window.resize.duration,1,function(){if(isAsync!==true&&jQuery.isFunction(self.options.current.callbacks.onContentVisible)){self.options.current.callbacks.onContentVisible(self)}})}else{if(isAsync!==true&&jQuery.isFunction(self.options.current.callbacks.onContentVisible)){self.options.current.callbacks.onContentVisible(self)}}});break}return true}};window.dom.element.addClass(self._.properties.classNames.window.frame);window.dom.element.addClass(self.options.current.css.window.className);var cssAttr={};if(!self.options.current.css.window.className){cssAttr.backgroundColor="#FFFFFF";cssAttr.color="#000000"}jQuery.extend(true,cssAttr,self.options.current.css.window);jQuery.extend(true,cssAttr,{boxSizing:"border-box",position:"fixed",zIndex:self.options.current.css.window.zIndex+UltimaDialog.collection.length});window.dom.element.css(cssAttr);window.dom.content.addClass(self._.properties.classNames.window.content);window.dom.element.append(window.dom.content);if(shadow!==undefined&&typeof content==="string"){content=content.replace(/<script/gi,'<scriptdisabled style="display: none !important;"');content=content.replace(/<\/script/gi,"</scriptdisabled")}window.setContent(content,shadow===undefined);if(self.options.current.behavior.closeOnWindow===true){window.dom.closeButton=jQuery("<div></div>");window.dom.closeButton.addClass(self._.properties.classNames.window.close);window.dom.closeButton.addClass(self.options.current.css.window.close.className);window.dom.closeButton.css(self.options.current.css.window.close);window.dom.closeButton.html(self.options.current.css.window.close.content);window.dom.element.prepend(window.dom.closeButton);window.dom.closeButton.click(function(){self.close()})}if(shadow!==true){jQuery(document).unbind("keydown",UltimaDialog._.methods.closeOnEscape);if(self.options.current.behavior.closeOnEscape===true){jQuery(document).bind("keydown",UltimaDialog._.methods.closeOnEscape)}jqWindow.resize(function(){UltimaDialog._.methods.resizePolling(self.options.current.animations.window.resize.rate)})}if(shadow!==true){UltimaDialog.collection.push(self)}return window},mergeOptions:function(options1,options2){self._.methods.translateOptions(options2);var result={};jQuery.extend(true,result,options1);jQuery.extend(true,result,options2);if(result.animations.curtain.hide.effect===undefined){result.animations.curtain.hide.effect=result.animations.curtain.show.effect}if(result.animations.curtain.hide.duration===undefined){result.animations.curtain.hide.duration=result.animations.curtain.show.duration}if(result.animations.window.hide.effect===undefined){result.animations.window.hide.effect=result.animations.window.show.effect}if(result.animations.window.hide.duration===undefined){result.animations.window.hide.duration=result.animations.window.show.duration}return result},translateOptions:function(options){var buffer,length,i,result,ref;for(var key in options){if(!options.hasOwnProperty(key)){continue}if(key.indexOf("->")!==0){continue}buffer=key.replace("->","");buffer=buffer.split(".");length=buffer.length;result={};ref=result;for(i=0;i<length-1;i++){ref[buffer[i]]={};ref=ref[buffer[i]]}ref[buffer[length-1]]=options[key];delete options[key];jQuery.extend(true,options,result)}return options}};this.options.current=this._.methods.mergeOptions(this.options["default"],UltimaDialog.options);this.options.current=this._.methods.mergeOptions(this.options.current,options)};UltimaDialog.collection=[];UltimaDialog.options={};UltimaDialog._={properties:{},methods:{}};UltimaDialog._.properties.resizePollingTimer=null;UltimaDialog._.methods.closeByIndex=function(index,step,animation){if(typeof step==="boolean"){animation=step;step=undefined}var dialog=UltimaDialog.collection[index];if(!dialog){return false}if(typeof step!=="number"){step=-1}dialog.close(function(){UltimaDialog._.methods.closeByIndex(index+step,animation)},animation);return true};UltimaDialog._.methods.closeOnEscape=function(event){if(event.which===27){UltimaDialog.close(false)}};UltimaDialog._.methods.disableScrolling=function(element){element.css({overflow:"hidden","-webkit-backface-visibility":"hidden"});return true};UltimaDialog._.methods.enableScrolling=function(element){element.css({overflow:"","-webkit-backface-visibility":""});return true};UltimaDialog._.methods.isOptions=function(data){if(!jQuery.isPlainObject(data)){return false}if(data.animations&&jQuery.isPlainObject(data.animations)||data.behavior&&jQuery.isPlainObject(data.behavior)||data.css&&jQuery.isPlainObject(data.css)||data.callbacks&&jQuery.isPlainObject(data.callbacks)){return true}for(var key in data){if(!data.hasOwnProperty(key)){continue}if(/^->[a-z]+(\.[a-z]+)?/.test(key)){return true}}return false};UltimaDialog._.methods.resizePolling=function(rate){clearTimeout(UltimaDialog._.properties.resizePollingTimer);UltimaDialog._.properties.resizePollingTimer=setTimeout(UltimaDialog.relocate,rate)};UltimaDialog._.methods.submit=function(form,ajaxSettings){var jqForm=jQuery(form);if(!jqForm.is("form")){return false}var len=UltimaDialog.collection.length;if(len===0){return false}var dialog=UltimaDialog.collection[len-1];var url=jqForm.attr("action");var endpoint="";if(typeof url==="string"){var pos=url.lastIndexOf("?");if(pos>=0){endpoint=url.substring(0,pos)}else{endpoint=url}}if(endpoint.length===0){url=dialog.window._.properties.url;if(dialog.window.query){if(jQuery.isPlainObject(dialog.window.query)){url+="?"+jQuery.param(dialog.window.query)}else if(dialog.window.query.length>0){url+="?"+dialog.window.query}}}var method=jqForm.attr("method");if(!/^(GET|POST|PUT|DELETE)$/i.test(method)){method="GET"}var data=jqForm.serialize();if(jQuery.isFunction(dialog.options.current.callbacks.onSubmit)){if(dialog.options.current.callbacks.onSubmit(dialog,data)===false){return false}}dialog.window.resetContent(function(){dialog.window.setContent({method:method.toUpperCase(),url:url,data:data,settings:ajaxSettings},false);if(dialog.window.dom.loading){dialog.window.dom.loading.css(dialog.window._.methods.calcInnerPosition(dialog.window.dom.loading));
}});return false};UltimaDialog.close=function(index,animate){if(typeof index==="boolean"){animate=index;index=undefined}var dialog=UltimaDialog.get(isNaN(parseInt(index))?0:parseInt(index));if(dialog===null){return false}dialog.close(animate===false?0:undefined);return true};UltimaDialog.closeAll=function(animate,deferProgression){var len=UltimaDialog.collection.length;if(len>0){if(deferProgression===true){UltimaDialog._.methods.closeByIndex(len-1,-1,animate);return true}var i=len-1;for(i;i>=0;i-=1){UltimaDialog.collection[i].close(animate===false?0:undefined)}return true}return false};UltimaDialog.get=function(index){var len=UltimaDialog.collection.length;if(len===0){return null}if(index===undefined){index=len-1}if(index>=len){return null}return UltimaDialog.collection[index]};UltimaDialog.isOpened=function(index){return UltimaDialog.get(index)!==null};UltimaDialog.relocate=function(index){var dialog=UltimaDialog.get(index);if(dialog===null){return false}dialog.window.relocate(true);return true};UltimaDialog.setOptions=function(index,options,overwrite){if(typeof index!=="number"){if(typeof options==="boolean"){overwrite=options}options=index;index=undefined}var dialog=UltimaDialog.get(index);if(dialog===null){return false}if(overwrite===true){dialog.options.current=dialog._.methods.mergeOptions({},options)}else{dialog.options.current=dialog._.methods.mergeOptions(dialog.options.current,options)}return true};jQuery.UltimaDialog={options:{}};jQuery.UltimaDialog.show=function(message,options){var mergedOptions={};jQuery.extend(true,mergedOptions,jQuery.UltimaDialog.options);jQuery.extend(true,mergedOptions,options);var dialog=new UltimaDialog(mergedOptions);dialog.show(message);return dialog};jQuery.each(["image","video","audio","iframe"],function(i,type){jQuery.UltimaDialog[type]=function(url,attributes,options){if(url===undefined){return null}var len=arguments.length;if(len===2){if(UltimaDialog._.methods.isOptions(attributes)){options=attributes;attributes=undefined}}var mergedOptions={};jQuery.extend(true,mergedOptions,jQuery.UltimaDialog.options);jQuery.extend(true,mergedOptions,options);var dialog=new UltimaDialog(mergedOptions);dialog[type](url,attributes);return dialog}});jQuery.each(["get","post","put","delete"],function(i,type){jQuery.UltimaDialog[type]=function(url,data,callback,options){if(url===undefined){return null}var len=arguments.length;if(len===3){if(!jQuery.isFunction(callback)){options=callback;callback=undefined}}else if(len===2){if(jQuery.isFunction(data)){callback=data;data=undefined}else if(UltimaDialog._.methods.isOptions(data)){options=data;data=undefined}}var mergedOptions={};jQuery.extend(true,mergedOptions,jQuery.UltimaDialog.options);jQuery.extend(true,mergedOptions,options);if(callback!==undefined){if(!jQuery.isPlainObject(mergedOptions.callbacks)){mergedOptions.callbacks={}}mergedOptions.callbacks.onAsyncSuccess=callback;mergedOptions.callbacks.onAsyncError=callback}var dialog=new UltimaDialog(mergedOptions);dialog[type](url,data);return dialog}});jQuery.fn.UltimaDialog=function(options){var mergedOptions={};jQuery.extend(true,mergedOptions,jQuery.UltimaDialog.options);jQuery.extend(true,mergedOptions,options);this.each(function(){new UltimaDialog(mergedOptions).show(this)});return this};UltimaDialog.version="0.95.2"}})();
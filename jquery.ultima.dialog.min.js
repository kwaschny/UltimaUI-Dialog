// MIT, Copyright (c) 2014-2017 Alexander Kwaschny, kwaschny.net
if(!window.UltimaDialog){if(jQuery===undefined){throw new Error("jQuery missing for UltimaDialog")}if(!jQuery.isPlainObject){throw new Error("jQuery 1.4+ required for UltimaDialog")}window.UltimaDialog=function(e){if(!(this instanceof UltimaDialog)){return new UltimaDialog(e)}this._={};var t=this;var i=jQuery(window);var n=jQuery("body");if(i.length===0||n.length===0){throw new Error("HTML document malformed")}this.curtain=null;this.window=null;this.options={};this.options.current={};this.options["default"]={animations:{curtain:{show:{effect:"fadeIn",duration:400},hide:{effect:undefined,duration:undefined},deferProgression:false},window:{show:{effect:"fadeIn",duration:400},hide:{effect:undefined,duration:undefined},deferProgression:false,reposition:{duration:100},resize:{duration:200,rate:200}}},behavior:{ajax:{cache:false},closeOnCurtain:true,closeOnEscape:true,closeOnWindow:true,disableScrolling:"auto",preventOverflow:true,trackSubmit:true,translateMedia:true,zIndexInc:true},css:{loading:{className:"",content:undefined,x:"50%",y:"50%"},curtain:{applyFilter:undefined,className:"",isVisible:true,zIndex:9003},window:{className:"",close:{className:""},hardMarginX:0,hardMarginY:0,x:"50%",y:"50%",zIndex:9004}},callbacks:{onOpening:undefined,onCurtainOpened:undefined,onWindowOpened:undefined,onContentReady:undefined,onContentVisible:undefined,onAsyncSuccess:undefined,onAsyncError:undefined,onSubmit:undefined,onClosing:undefined,onCurtainClosed:undefined,onWindowClosed:undefined}};this._.properties={classNames:{curtain:"UltimaDialog-curtain",window:{frame:"UltimaDialog-window",content:"UltimaDialog-window-content",close:"UltimaDialog-window-close"}},simulateBorderBox:window.atob===undefined,simulateTransparentBackground:window.atob===undefined,supportsFilter:window.atob!==undefined,supportsMedia:window.atob!==undefined};this.show=function(e){if(jQuery.isFunction(this.options.current.callbacks.onOpening)){if(this.options.current.callbacks.onOpening(t)===false){return false}}this.curtain=t._.methods.createCurtain();this.window=t._.methods.createWindow(e);this.curtain._.properties.window=this.window;this.window._.properties.curtain=this.curtain;if(this.options.current.behavior.disableScrolling===true){UltimaDialog._.methods.disableScrolling(n)}n.append(this.curtain.dom.element).append(this.window.dom.element);this.window.relocate();if(this.options.current.animations.curtain.deferProgression===true){this.curtain.show(function(){if(jQuery.isFunction(t.options.current.callbacks.onCurtainOpened)){t.options.current.callbacks.onCurtainOpened(t)}t.window.show(t.window._.properties.isAjax);if(t.window.dom.loading){t.window.dom.loading.css(t.window._.methods.calcInnerPosition(t.window.dom.loading))}})}else{this.curtain.show(function(){if(jQuery.isFunction(t.options.current.callbacks.onCurtainOpened)){t.options.current.callbacks.onCurtainOpened(t)}});this.window.show(t.window._.properties.isAjax);if(this.window.dom.loading){this.window.dom.loading.css(this.window._.methods.calcInnerPosition(this.window.dom.loading))}}return true};this.image=function(e,t){this.show({media:"image",resource:e,attributes:t});return true};this.video=function(e,t){this.show({media:"video",resource:e,attributes:t});return true};this.audio=function(e,t){this.show({media:"audio",resource:e,attributes:t});return true};jQuery.each(["get","post","put","delete"],function(e,i){t[i]=function(e,t,n){this.show({method:i.toUpperCase(),url:e,data:t,settings:n});return true}});this.iframe=function(e,t){this.show({media:"iframe",resource:e,attributes:t});return true};this.close=function(e,t){if(!jQuery.isFunction(e)){t=e;e=undefined}UltimaDialog._.methods.enableScrolling(n);if(this.window!==null){this.window.close(e,t);return true}return false};this._.methods={createCurtain:function(){var e={dom:{element:jQuery("<div></div>").hide()},close:function(e,i){var n=this;if(typeof e==="number"){i=e;e=undefined}this._.methods.filterOff();switch(t.options.current.animations.curtain.hide.effect){case"fadeIn":default:this.dom.element.stop(true,true).fadeOut(i===undefined?t.options.current.animations.curtain.hide.duration:i,function(){n.dom.element.remove();if(jQuery.isFunction(e)){e(t)}if(jQuery.isFunction(t.options.current.callbacks.onCurtainClosed)){t.options.current.callbacks.onCurtainClosed(t)}});break}return true},show:function(e){var i=this;switch(t.options.current.animations.curtain.show.effect){case"fadeIn":default:this.dom.element.fadeIn(t.options.current.animations.curtain.show.duration,function(){i.isOpened=true;if(jQuery.isFunction(e)){e(t)}});break}return true},_:{properties:{isOpened:false,window:undefined},methods:{filterOn:function(){if(t._.properties.supportsFilter===false){return false}var e=t.options.current.css.curtain.applyFilter;if(typeof e!=="string"){return false}var i=n.children(":not(script, style)");jQuery.each(i,function(i,n){var o=jQuery(n);if(!o.hasClass(t._.properties.classNames.curtain)&&!o.hasClass(t._.properties.classNames.window)){o.css({"-webkit-filter":e,filter:e})}});return true},filterOff:function(){if(t._.properties.supportsFilter===false){return false}var e=t.options.current.css.curtain.applyFilter;if(typeof e!=="string"){return false}var i=n.children(":not(script, style)");jQuery.each(i,function(e,i){var n=jQuery(i);if(!n.hasClass(t._.properties.classNames.curtain)&&!n.hasClass(t._.properties.classNames.window)){n.css({"-webkit-filter":"",filter:""})}});return true}}}};e.dom.element.addClass(t._.properties.classNames.curtain);e.dom.element.addClass(t.options.current.css.curtain.className);var i={};if(!t.options.current.css.curtain.className){i.backgroundColor="#000000";i.opacity=.67}jQuery.extend(true,i,t.options.current.css.curtain);jQuery.extend(true,i,{bottom:0,height:"100%",left:0,position:"fixed",right:0,top:0,width:"100%",zIndex:t.options.current.css.curtain.zIndex+(t.options.current.behavior.zIndexInc?UltimaDialog.collection.length:0)});if(t.options.current.css.curtain.isVisible===false){i.background=t._.properties.simulateTransparentBackground?"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)":"transparent"}e.dom.element.css(i);e._.methods.filterOn();e.dom.element.click(function(){if(t.options.current.behavior.closeOnCurtain!==true){return}if(!e.isOpened){return}if(t.options.current.behavior.disableScrolling!==false){UltimaDialog._.methods.enableScrolling(n)}e._.properties.window.close()});return e},createWindow:function(e,o){var r={dom:{element:jQuery("<div></div>").hide(),content:jQuery("<div></div>").css("opacity",0),loading:undefined,closeButton:undefined},_:{properties:{curtain:undefined,isAjax:false,url:undefined},methods:{attachSubmitTracking:function(){if(o){return false}var e=r.dom.content.find("form");e.submit(function(e){e.preventDefault();return UltimaDialog._.methods.submit(this)});return true},calcPosition:function(e,n){var o={};if(e===undefined){e=r.dom.element.outerWidth()}if(n===undefined){n=r.dom.element.outerHeight()}if(/^[0-9]{1,3}%$/.test(t.options.current.css.window.x)){o.left=t.options.current.css.window.x.replace("%","")*i.width()/100-e/2}else{o.left=t.options.current.css.window.x}if(o.left<0){o.left=0}if(/^[0-9]{1,3}%$/.test(t.options.current.css.window.y)){o.top=t.options.current.css.window.y.replace("%","")*i.height()/100-n/2}else{o.top=t.options.current.css.window.y}if(o.top<0){o.top=0}return o},calcInnerPosition:function(e){var i={};if(/^[0-9]{1,3}%$/.test(t.options.current.css.loading.x)){i.marginLeft=t.options.current.css.loading.x.replace("%","")*r.dom.content.innerWidth()/100-e.width()/2}else{i.marginLeft=t.options.current.css.loading.x}if(i.marginLeft<0){i.marginLeft=0}if(/^[0-9]{1,3}%$/.test(t.options.current.css.loading.y)){var n=r._.methods.getPadding(r.dom.element);n=n.bottom+n.top;i.marginTop=t.options.current.css.loading.y.replace("%","")*(r.dom.element.innerHeight()-n)/100-e.height()/2}else{i.marginTop=t.options.current.css.loading.y}if(i.marginTop<0){i.marginTop=0}return i},calcSize:function(e){var o=t._.methods.createWindow(e,true).dom.element;o.css({display:"none",left:0,top:0});n.append(o);var s={width:o.outerWidth(),height:o.outerHeight()};if(t._.properties.simulateBorderBox){var a=r._.methods.getPadding(o);s.width-=a.left+a.right;s.height-=a.bottom+a.top}o.remove();var u=i.width();u-=t.options.current.css.window.hardMarginX;var c=i.height();c-=t.options.current.css.window.hardMarginY;if(s.width>u){s.width=u}if(s.height>c){s.height=c}return s},getPadding:function(e){return{bottom:isNaN(parseInt(e.css("padding-bottom"),10))?0:parseInt(e.css("padding-bottom"),10),left:isNaN(parseInt(e.css("padding-left"),10))?0:parseInt(e.css("padding-left"),10),right:isNaN(parseInt(e.css("padding-right"),10))?0:parseInt(e.css("padding-right"),10),top:isNaN(parseInt(e.css("padding-top"),10))?0:parseInt(e.css("padding-top"),10)}},rememberSize:function(e){var i={width:e.outerWidth(),height:e.outerHeight()};if(t._.properties.simulateBorderBox){var n=r._.methods.getPadding(e);i.width-=n.left+n.right;i.height-=n.bottom+n.top}e.css({"min-height":i.height,"min-width":i.width});return true},setLoading:function(){if(t.options.current.css.loading.content||t.options.current.css.loading.className){var e=jQuery("<div></div>");e.addClass(t.options.current.css.loading.className);var i={};jQuery.extend(i,t.options.current.css.loading);delete i.content;e.css(i);if(typeof t.options.current.css.loading.content==="string"){e.html(t.options.current.css.loading.content)}else if(t.options.current.css.loading.content instanceof jQuery){e.append(jQuery(t.options.current.css.loading.content).clone(true).show())}r.dom.loading=e;r.dom.content.append(e);r.dom.content.fadeTo(t.options.current.animations.window.resize.duration,1)}}}},close:function(e,i){var n=this;if(jQuery.isFunction(t.options.current.callbacks.onClosing)){if(t.options.current.callbacks.onClosing(t)===false){return false}}for(var o=0;o<UltimaDialog.collection.length;o++){if(this===UltimaDialog.collection[o].window){UltimaDialog.collection.splice(o,1)}}switch(t.options.current.animations.window.hide.effect){case"fadeIn":default:if(t.options.current.animations.window.deferProgression!==true){this._.properties.curtain.close(i===undefined?undefined:0)}this.dom.element.stop(true,true).fadeOut(i===undefined?t.options.current.animations.window.hide.duration:0,function(){n.dom.element.remove();if(jQuery.isFunction(e)){e(t)}if(jQuery.isFunction(t.options.current.callbacks.onWindowClosed)){t.options.current.callbacks.onWindowClosed(t)}if(t.options.current.animations.window.deferProgression===true){n._.properties.curtain.close(i===undefined?undefined:0)}});break}return true},reposition:function(e,t,i){if(e===undefined){e=0}else{if(jQuery.isFunction(e)){if(jQuery.isFunction(t)){i=t;t=e;e=0}else{i=e;e=0}}else{if(!jQuery.isFunction(i)){i=t;t=undefined}}}var n=this._.methods.calcPosition();if(e>0){if(jQuery.isFunction(t)){if(t(this)===false){return false}}this.dom.element.animate(n,e,i)}else{if(jQuery.isFunction(t)){if(t(this)===false){return false}}this.dom.element.css(n);if(jQuery.isFunction(i)){i(this)}}return true},resetContent:function(e,i){r.dom.content.fadeTo(t.options.current.animations.window.resize.duration,0,function(){if(i!==undefined){r.dom.content.children(i).remove()}else{r.dom.content.html("")}if(jQuery.isFunction(e)){e(t)}});return true},resize:function(e){if(t.options.current.behavior.preventOverflow!==true){return false}var o=t.options.current.css.window.width!==undefined||t.options.current.css.window.height!==undefined;var r=t.options.current.css.window.width;if(/^[0-9]{1,3}%$/.test(r)){r=r.replace("%","")*i.width()/100}if(isNaN(parseFloat(r))){r=this.dom.element.outerWidth()}var s=t.options.current.css.window.height;if(/^[0-9]{1,3}%$/.test(s)){s=s.replace("%","")*i.height()/100}if(isNaN(parseFloat(s))){s=this.dom.element.outerHeight()}var a=this._.methods.getPadding(this.dom.element);var u=a.left+a.right;var c=a.bottom+a.top;var d=false;if(r>i.width()-u){d=true;r=i.width()-u;this.dom.content.css({overflow:"auto","max-width":r})}else{this.dom.content.css("max-width","");if(o){this.dom.content.css("width",r-u)}else{this.dom.content.css("width","")}}if(s>i.height()-c){d=true;s=i.height()-c;this.dom.content.css({"max-height":s,overflow:"auto"})}else{this.dom.content.css("max-height","");if(o){this.dom.content.css("height",s-c)}else{this.dom.content.css("height","")}}this.dom.content.css("overflow",o||d?"auto":"");if(t.options.current.behavior.disableScrolling==="auto"){if(e||o||d){UltimaDialog._.methods.disableScrolling(n)}else{UltimaDialog._.methods.enableScrolling(n)}}return true},relocate:function(e){var i=0;if(e===true){i=t.options.current.animations.window.reposition.duration}this.resize();this.reposition(i);return true},setContent:function(e,n){if(!e){r.resetContent();return false}r._.properties.isAjax=false;r._.properties.url=location.href;if(/^(GET|POST|PUT|DELETE)$/i.test(e.method)){r._.properties.isAjax=true;r._.methods.setLoading();var o=jQuery.extend(true,e.settings,{type:e.method,url:e.url,data:e.data,cache:t.options.current.behavior.ajax.cache,success:function(e){if(jQuery.isFunction(t.options.current.callbacks.onAsyncSuccess)){if(t.options.current.callbacks.onAsyncSuccess(t,e)===false){return false}}r._.methods.rememberSize(r.dom.element);var i=r._.methods.calcSize(e);var n=r._.methods.calcPosition(i.width,i.height);r.resetContent(function(){r.dom.loading=undefined;r.dom.element.animate({"min-height":i.height,left:n.left,top:n.top,"min-width":i.width},t.options.current.animations.window.resize.duration,function(){if(jQuery.isFunction(t.options.current.callbacks.onContentReady)){if(t.options.current.callbacks.onContentReady(t,e)===false){return}}r.dom.content.html(e);if(t.options.current.behavior.trackSubmit===true){r._.methods.attachSubmitTracking()}r.resize();r.dom.content.fadeTo(t.options.current.animations.window.show.duration,1,function(){if(jQuery.isFunction(t.options.current.callbacks.onContentVisible)){t.options.current.callbacks.onContentVisible(t)}})})})},error:function(e){var i=e.status+": "+e.statusText;if(jQuery.isFunction(t.options.current.callbacks.onAsyncError)){t.options.current.callbacks.onAsyncError(t,e)}r._.methods.rememberSize(r.dom.element);var n=r._.methods.calcSize(i);var o=r._.methods.calcPosition(n.width,n.height);r.resetContent(function(){r.dom.loading=undefined;r.dom.element.animate({"min-height":n.height,left:o.left,top:o.top,"min-width":n.width},t.options.current.animations.window.resize.duration,function(){if(jQuery.isFunction(t.options.current.callbacks.onContentReady)){if(t.options.current.callbacks.onContentReady(t,i)===false){return}}r.dom.content.html(i);r.resize();r.dom.content.fadeTo(t.options.current.animations.window.show.duration,1,function(){if(jQuery.isFunction(t.options.current.callbacks.onContentVisible)){t.options.current.callbacks.onContentVisible(t)}})})})}});r._.properties.url=o.url;if(e.method==="GET"){r.query=o.data}else{r.query=""}jQuery.ajax(o)}else if(e.media==="iframe"){var s=jQuery("<iframe>").css({height:0,opacity:0,width:0});if(!e.attributes){e.attributes={}}if(typeof e.attributes.width!=="number"){e.attributes.width=640}if(typeof e.attributes.height!=="number"){e.attributes.height=360}s.attr(e.attributes);s.attr("src",e.resource);r.dom.content.html(s);s.load(function(){s.unbind("load");if(jQuery.isFunction(t.options.current.callbacks.onAsyncSuccess)){if(t.options.current.callbacks.onAsyncSuccess(t,e.resource)===false){return false}}r._.methods.rememberSize(r.dom.element);var i=r._.methods.getPadding(r.dom.element);var n={width:(isNaN(parseInt(s.attr("width"),10))?0:parseInt(s.attr("width"),10))+(t._.properties.simulateBorderBox?0:i.left+i.right),height:(isNaN(parseInt(s.attr("height"),10))?0:parseInt(s.attr("height"),10))+(t._.properties.simulateBorderBox?0:i.bottom+i.top)};var o=r._.methods.calcPosition(n.width,n.height);r.resetContent(function(){r.dom.loading=undefined;r.dom.element.animate({"min-height":n.height,left:o.left,top:o.top,"min-width":n.width},t.options.current.animations.window.resize.duration,function(){s.css({height:"",opacity:1,width:""});if(jQuery.isFunction(t.options.current.callbacks.onContentReady)){if(t.options.current.callbacks.onContentReady(t,s)===false){return}}r.resize();r.dom.content.fadeTo(t.options.current.animations.window.show.duration,1,function(){if(jQuery.isFunction(t.options.current.callbacks.onContentVisible)){t.options.current.callbacks.onContentVisible(t)}})})},":not(iframe)")});r._.methods.setLoading()}else if(e.media==="image"){var a=jQuery("<img>");a.load(function(){if(jQuery.isFunction(t.options.current.callbacks.onAsyncSuccess)){if(t.options.current.callbacks.onAsyncSuccess(t,e.resource)===false){return false}}r._.methods.rememberSize(r.dom.element);var i=r._.methods.calcSize(a);var n=r._.methods.calcPosition(i.width,i.height);r.resetContent(function(){r.dom.loading=undefined;r.dom.element.animate({"min-height":i.height,left:n.left,top:n.top,"min-width":i.width},t.options.current.animations.window.resize.duration,function(){if(jQuery.isFunction(t.options.current.callbacks.onContentReady)){if(t.options.current.callbacks.onContentReady(t,a)===false){return}}r.dom.content.html(a);r.resize();r.dom.content.fadeTo(t.options.current.animations.window.show.duration,1,function(){if(jQuery.isFunction(t.options.current.callbacks.onContentVisible)){t.options.current.callbacks.onContentVisible(t)}})})})});if(!e.attributes){e.attributes={}}if(e.attributes.width){a.css("width",e.attributes.width);delete e.attributes.width}else{a.css("width","auto")}if(e.attributes.height){a.css("height",e.attributes.height);delete e.attributes.height}else{a.css("height","auto")}a.attr(e.attributes);a.attr("src",e.resource);r._.methods.setLoading()}else if(e.media==="video"||e.media==="audio"){var u=jQuery("<"+e.media+">").attr("controls","controls").css({height:0,opacity:0,width:0});if(!jQuery.isArray(e.resource)){e.resource=[e.resource]}jQuery.each(e.resource,function(e,t){var i=jQuery("<source>").attr("src",t);u.append(i)});u.append(jQuery("<a>").attr("href",e.resource[0]).text(e.resource[0]));var c={video:{width:640,height:360},audio:{width:320,height:30}};if(i[0].ActiveXObject||"ActiveXObject"in i[0]){c.audio.width=580;c.audio.height=80}if(!e.attributes){e.attributes={}}if(typeof e.attributes.width!=="number"){e.attributes.width=c[e.media].width}if(typeof e.attributes.height!=="number"){e.attributes.height=c[e.media].height}u.attr(e.attributes);u.attr("src",e.resource);r.dom.content.html(u);var d=function(){if(jQuery.isFunction(t.options.current.callbacks.onAsyncSuccess)){if(t.options.current.callbacks.onAsyncSuccess(t,e.resource)===false){return false}}r._.methods.rememberSize(r.dom.element);var i=r._.methods.getPadding(r.dom.element);var n={width:(isNaN(parseInt(u.attr("width"),10))?0:parseInt(u.attr("width"),10))+(i.left+i.right),height:(isNaN(parseInt(u.attr("height"),10))?0:parseInt(u.attr("height"),10))+(i.bottom+i.top)};var o=r._.methods.calcPosition(n.width,n.height);r.resetContent(function(){r.dom.loading=undefined;r.dom.element.animate({"min-height":n.height,left:o.left,top:o.top,"min-width":n.width},t.options.current.animations.window.resize.duration,function(){u.css({height:"",opacity:1,width:e.attributes.width});if(jQuery.isFunction(t.options.current.callbacks.onContentReady)){if(t.options.current.callbacks.onContentReady(t,u)===false){return}}r.resize();r.dom.content.fadeTo(t.options.current.animations.window.show.duration,1,function(){if(jQuery.isFunction(t.options.current.callbacks.onContentVisible)){t.options.current.callbacks.onContentVisible(t)}})})},":not("+e.media+")")};if(t._.properties.supportsMedia){u[0].onloadstart=d}else{if(jQuery.isFunction(t.options.current.callbacks.onAsyncError)){t.options.current.callbacks.onAsyncError(t,"Browser does not support the required media tag: "+e.media)}setTimeout(d,200)}r._.methods.setLoading()}else if(typeof e==="string"){if(t.options.current.behavior.translateMedia===true){if(/\.(gif|jpe?g|png)(\?|$)/i.test(e)){return r.setContent({media:"image",resource:e})}if(/\.(mp3)(\?|$)/i.test(e)){return r.setContent({media:"audio",resource:e})}}if(n!==false&&jQuery.isFunction(t.options.current.callbacks.onContentReady)){if(t.options.current.callbacks.onContentReady(t,e)===false){return false}}r.dom.content.html(e);if(t.options.current.behavior.trackSubmit===true){r._.methods.attachSubmitTracking()}}else{e=jQuery(e).clone(true);e.removeAttr("id").find("[id]").removeAttr("id");e.find("[data-ultimadialog-id]").each(function(){var t=jQuery(this);var i=t.attr("data-ultimadialog-id");var n=i+Math.floor(Math.random()*1e4);t.attr("id",n);e.find('[data-ultimadialog-for="'+i+'"]').attr("for",n)});if(n!==false&&jQuery.isFunction(t.options.current.callbacks.onContentReady)){if(t.options.current.callbacks.onContentReady(t,e)===false){return false}}r.dom.content.html(e.show());if(t.options.current.behavior.trackSubmit===true){r._.methods.attachSubmitTracking()}}return true},show:function(e){var i=this;switch(t.options.current.animations.window.show.effect){case"fadeIn":default:if(t.options.current.animations.curtain.deferProgression!==true){this.dom.content.css("opacity",1)}this.dom.element.fadeIn(t.options.current.animations.window.show.duration,function(){if(jQuery.isFunction(t.options.current.callbacks.onWindowOpened)){t.options.current.callbacks.onWindowOpened(t)}if(t.options.current.animations.curtain.deferProgression===true){i.dom.content.fadeTo(t.options.current.animations.window.resize.duration,1,function(){if(e!==true&&jQuery.isFunction(t.options.current.callbacks.onContentVisible)){t.options.current.callbacks.onContentVisible(t)}})}else{if(e!==true&&jQuery.isFunction(t.options.current.callbacks.onContentVisible)){t.options.current.callbacks.onContentVisible(t)}}});break}return true}};r.dom.element.addClass(t._.properties.classNames.window.frame);r.dom.element.addClass(t.options.current.css.window.className);var s={};if(!t.options.current.css.window.className){s.backgroundColor="#FFFFFF";s.color="#000000"}jQuery.extend(true,s,t.options.current.css.window);jQuery.extend(true,s,{boxSizing:"border-box",position:"fixed",zIndex:t.options.current.css.window.zIndex+UltimaDialog.collection.length});r.dom.element.css(s);r.dom.content.addClass(t._.properties.classNames.window.content);r.dom.element.append(r.dom.content);if(o!==undefined&&typeof e==="string"){e=e.replace(/<script/gi,'<scriptdisabled style="display: none !important;"');e=e.replace(/<\/script/gi,"</scriptdisabled")}r.setContent(e,o===undefined);if(t.options.current.behavior.closeOnWindow===true){r.dom.closeButton=jQuery("<div></div>");r.dom.closeButton.addClass(t._.properties.classNames.window.close);r.dom.closeButton.addClass(t.options.current.css.window.close.className);r.dom.closeButton.css(t.options.current.css.window.close);r.dom.closeButton.html(t.options.current.css.window.close.content);r.dom.element.prepend(r.dom.closeButton);r.dom.closeButton.click(function(){t.close()})}if(o!==true){jQuery(document).unbind("keydown",UltimaDialog._.methods.closeOnEscape);if(t.options.current.behavior.closeOnEscape===true){jQuery(document).bind("keydown",UltimaDialog._.methods.closeOnEscape)}i.resize(function(){UltimaDialog._.methods.resizePolling(t.options.current.animations.window.resize.rate)})}if(o!==true){UltimaDialog.collection.push(t)}return r},mergeOptions:function(e,i){t._.methods.translateOptions(i);var n={};jQuery.extend(true,n,e);jQuery.extend(true,n,i);if(n.animations.curtain.hide.effect===undefined){n.animations.curtain.hide.effect=n.animations.curtain.show.effect}if(n.animations.curtain.hide.duration===undefined){n.animations.curtain.hide.duration=n.animations.curtain.show.duration}if(n.animations.window.hide.effect===undefined){n.animations.window.hide.effect=n.animations.window.show.effect}if(n.animations.window.hide.duration===undefined){n.animations.window.hide.duration=n.animations.window.show.duration}return n},translateOptions:function(e){var t,i,n,o,r;for(var s in e){if(!e.hasOwnProperty(s)){continue}if(s.indexOf("->")!==0){continue}t=s.replace("->","");t=t.split(".");i=t.length;o={};r=o;for(n=0;n<i-1;n++){r[t[n]]={};r=r[t[n]]}r[t[i-1]]=e[s];delete e[s];jQuery.extend(true,e,o)}return e}};this.options.current=this._.methods.mergeOptions(this.options["default"],UltimaDialog.options);this.options.current=this._.methods.mergeOptions(this.options.current,e)};UltimaDialog.collection=[];UltimaDialog.options={};UltimaDialog._={properties:{},methods:{}};UltimaDialog._.properties.resizePollingTimer=null;UltimaDialog._.methods.closeByIndex=function(e,t,i){if(typeof t==="boolean"){i=t;t=undefined}var n=UltimaDialog.collection[e];if(!n){return false}if(typeof t!=="number"){t=-1}n.close(function(){UltimaDialog._.methods.closeByIndex(e+t,i)},i);return true};UltimaDialog._.methods.closeOnEscape=function(e){if(e.which===27){UltimaDialog.close(false)}};UltimaDialog._.methods.disableScrolling=function(e){e.css({overflow:"hidden","-webkit-backface-visibility":"hidden"});return true};UltimaDialog._.methods.enableScrolling=function(e){e.css({overflow:"","-webkit-backface-visibility":""});return true};UltimaDialog._.methods.isOptions=function(e){if(!jQuery.isPlainObject(e)){return false}if(e.animations&&jQuery.isPlainObject(e.animations)||e.behavior&&jQuery.isPlainObject(e.behavior)||e.css&&jQuery.isPlainObject(e.css)||e.callbacks&&jQuery.isPlainObject(e.callbacks)){return true}for(var t in e){if(!e.hasOwnProperty(t)){continue}if(/^->[a-z]+(\.[a-z]+)?/.test(t)){return true}}return false};UltimaDialog._.methods.resizePolling=function(e){clearTimeout(UltimaDialog._.properties.resizePollingTimer);UltimaDialog._.properties.resizePollingTimer=setTimeout(UltimaDialog.relocate,e)};UltimaDialog._.methods.submit=function(e,t){var i=jQuery(e);if(!i.is("form")){return false}var n=UltimaDialog.collection.length;if(n===0){return false}var o=UltimaDialog.collection[n-1];var r=i.attr("action");var s="";if(typeof r==="string"){var a=r.lastIndexOf("?");if(a>=0){s=r.substring(0,a)}else{s=r}}if(s.length===0){r=o.window._.properties.url;if(o.window.query){if(jQuery.isPlainObject(o.window.query)){r+="?"+jQuery.param(o.window.query)}else if(o.window.query.length>0){r+="?"+o.window.query}}}var u=i.attr("method");if(!/^(GET|POST|PUT|DELETE)$/i.test(u)){u="GET"}var c=i.serialize();if(jQuery.isFunction(o.options.current.callbacks.onSubmit)){if(o.options.current.callbacks.onSubmit(o,c)===false){return false}}o.window.resetContent(function(){o.window.setContent({method:u.toUpperCase(),url:r,data:c,settings:t},false);if(o.window.dom.loading){o.window.dom.loading.css(o.window._.methods.calcInnerPosition(o.window.dom.loading))}});return false};UltimaDialog.close=function(e,t){if(typeof e==="boolean"){t=e;e=undefined}var i=UltimaDialog.get(isNaN(parseInt(e))?0:parseInt(e));if(i===null){return false}i.close(t===false?0:undefined);return true};UltimaDialog.closeAll=function(e,t){var i=UltimaDialog.collection.length;if(i>0){if(t===true){UltimaDialog._.methods.closeByIndex(i-1,-1,e);return true}var n=i-1;for(n;n>=0;n-=1){UltimaDialog.collection[n].close(e===false?0:undefined)}return true}return false};UltimaDialog.get=function(e){var t=UltimaDialog.collection.length;if(t===0){return null}if(e===undefined){e=t-1}if(e>=t){return null}return UltimaDialog.collection[e]};UltimaDialog.isOpened=function(e){return UltimaDialog.get(e)!==null};UltimaDialog.relocate=function(e){var t=UltimaDialog.get(e);if(t===null){return false}t.window.relocate(true);return true};UltimaDialog.setOptions=function(e,t,i){if(typeof e!=="number"){if(typeof t==="boolean"){i=t}t=e;e=undefined}var n=UltimaDialog.get(e);if(n===null){return false}if(i===true){n.options.current=n._.methods.mergeOptions({},t)}else{n.options.current=n._.methods.mergeOptions(n.options.current,t)}return true};jQuery.UltimaDialog={options:{}};jQuery.UltimaDialog.show=function(e,t){var i={};jQuery.extend(true,i,jQuery.UltimaDialog.options);jQuery.extend(true,i,t);var n=new UltimaDialog(i);n.show(e);return n};jQuery.each(["image","video","audio","iframe"],function(e,t){jQuery.UltimaDialog[t]=function(e,i,n){if(e===undefined){return null}var o=arguments.length;if(o===2){if(UltimaDialog._.methods.isOptions(i)){n=i;i=undefined}}var r={};jQuery.extend(true,r,jQuery.UltimaDialog.options);jQuery.extend(true,r,n);var s=new UltimaDialog(r);s[t](e,i);return s}});jQuery.each(["get","post","put","delete"],function(e,t){jQuery.UltimaDialog[t]=function(e,i,n,o){if(e===undefined){return null}var r=arguments.length;if(r===3){if(!jQuery.isFunction(n)){o=n;n=undefined}}else if(r===2){if(jQuery.isFunction(i)){n=i;i=undefined}else if(UltimaDialog._.methods.isOptions(i)){o=i;i=undefined}}var s={};jQuery.extend(true,s,jQuery.UltimaDialog.options);jQuery.extend(true,s,o);if(n!==undefined){if(!jQuery.isPlainObject(s.callbacks)){s.callbacks={}}s.callbacks.onAsyncSuccess=n;s.callbacks.onAsyncError=n}var a=new UltimaDialog(s);a[t](e,i);return a}});jQuery.fn.UltimaDialog=function(e){var t={};jQuery.extend(true,t,jQuery.UltimaDialog.options);jQuery.extend(true,t,e);this.each(function(){new UltimaDialog(t).show(this)});return this};UltimaDialog.version="0.94.12"}